---
counts:
    characters_real: 2711
    characters_total: 3342
    file: ./posts/tech/how-charming/_posts/2016-12-15-part-2.md
    paragraphs: 24
    type: jekyll
    words: 574
layout: serial-post
previous_in_category:
    title: How Charming - Part 1
    url: /posts/tech/how-charming/2016/12/13/part-1
title: How Charming - Part 2
---

*In the previous part, we started to nail down what it is that we're going to do to try and accomplish our task. We're going tow rite a charm - a package that represents a way to deploy a piece of software repeatably to the cloud - to do all that's needed to host a WSGI app. It will be able to talk to several different services and use any WSGI server. For more background, [check that post out first](/posts/tech/how-charming/2016/12/13/part-1)!*

"Hey! I think I have deployment all figured out for Honeycomb!" I blurted out in the Guild chat, sharing the link to the previous post.

Blank stares, then finally, "You wrote about the furry website you're building for work[^disclaimer]..?"

![It's true](/assets/tech/how-charming/part-2-furries.jpg){: style="max-width: 150px; float: left; margin: 0 1em 1em 0;" }

Point. But hey, furries make the internet go.[^furries-tech]

Anyhow, I digress. The goal of Honeycomb is not to be a furry website but a writing one, and besides, none of the guild really cared about the DevOps side of the site. That's something for me to worry about.  And as a developer with a fascination with the Ops side of things, I *do* care about deployment strategies.

Guild chat aside, Juju is a delightful step in making things much easier for us DevOpsy critters, because it allows us to write general and repeatable solutions that can be used within a ecosystem of other solutions to accomplish a specific goal. In our case, we want to be able to deploy any WSGI compliant application that can connect to a variety of other services and be hosted in the cloud.

These solutions, charms, are what we'll need to have to get our stack up and running, so let's get started in making our `wsgi-app` charm.

-----

### Bootstrapping the charm

As Juju is a Canonical offering (and I'm a Canonical employee), I'll be working in Ubuntu. Once you've got your system up and running with Ubuntu Xenial or later, installation of juju and the tools we need is fairly easy:

```shell
makyo@corrin:~$ sudo apt install juju lxd charm-tools
```

This will install just about everything we need: we'll get juju itself, of course, as well as LXD, which is used for local and development environments, and `charm-tools`, which contains a few applications we'll be using for creating, building, and testing our charm.

Getting our charm set up after this point is fairly easy, but it does require deciding on how you're going to work with your charm. I have a work directory in which I keep all of my projects, and when developing a charm, it's often easiest to have all of your charm related work in its own directory structure. With that in mind, I'm going to set up the following directory structure for working with `wsgi-app`:

```
~
└── work
    └── charms
        ├── builds
        ├── interfaces
        └── layers
```

We'll get into what interfaces and layers are in just a second, but for now, that's the basic structure that one needs to get started with building a charm. This is because the various charm tools expect to find a certain structure when they do their work.  This is all controlled through environment variables:

```bash
export JUJU_REPOSITORY=$HOME/work/charms
export LAYER_PATH=$JUJU_REPOSITORY/layers
export INTERFACE_PATH=$JUJU_REPOSITORY/interfaces

# or, in fish:

set -x JUJU_REPOSITORY ~/work/charms
set -x LAYER_PATH $JUJU_REPOSITORY/layers
set -x INTERFACE_PATH $JUJU_REPOSITORY/interfaces

# then:

mkdir -p $LAYER_PATH $INTERFACE_PATH
```

-----

[^disclaimer]: As always, views are my own, not my employer's.

[^furries-tech]: Seriously. After students (54%), nearly 10% of furries are employed in the tech industry, making it the most common occupation within the subculture. (The Furry Poll, conducted March-December 2015, *n=11831*)
